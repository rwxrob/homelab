
# ansible-playbook -i inventory -l all -K swapoff.yaml

- name: swapoff
  hosts: all
  become: yes
  become_user: root
  tasks:

    - name: Disable swap for current session
      command: swapoff -a

    - name: Disable swap permanently, persist reboots
      replace:
        path: /etc/fstab
        regexp: '^(\s*)([^#\n]+\s+)(\w+\s+)swap(\s+.*)$'
        replace: '#\1\2\3swap\4'
        backup: yes

